# Cursor 项目专用规则（novel-electron）

## 助手通用行为

- **回复语言**：默认使用简体中文回答用户问题。
- **命令行环境**：这是 Windows 项目，如需给出命令行示例，请使用 `cmd` 语法（例如 `cd /d E:\aiApi\novel-electron && npm run dev`），不要使用 `bash`/`zsh` 风格命令。
- **修改优先级**：优先直接修改代码解决问题，而不是只给出“可以这样改”的文字说明；只有在用户明确说“只要思路/不要改代码”时才只讲方案。
- **工具使用**：
  - 读/改代码必须使用 Cursor 提供的读写工具（例如 `read_file`、`apply_patch`）。
  - 在做较大改动前，先阅读相关文件，避免与现有风格冲突。
  - 进行一组相关修改后，尽量检查对应文件的 linter 结果（`read_lints`），避免引入新的错误。

## 项目结构与约定

- **前端入口**：`src/main.js`，根组件 `src/App.vue`。
- **页面组件**：仅放在 `src/pages/` 目录下，对应路由页面：
  - `Home.vue` / `NovelList.vue` / `NovelDetail.vue` / `Workbench.vue` / `Reader.vue` / `Settings.vue`
- **面板组件**：放在 `src/panels/`，作为工作台子区域：
  - `NovelTree.vue`（章节树）、`EditorPanel.vue`（正文编辑）、`AgentPanel.vue`（AI 助手）
- **布局组件**：在 `src/layouts/`，例如 `MainLayout.vue`、`WorkbenchLayout.vue`。
- **状态管理**：使用 Pinia，当前主要为 `src/stores/novel.js`，如需新增 store，放在该目录下。
- **路由**：集中在 `src/router/index.js` 维护，如需新增页面优先走路由。
- **数据库与 Electron 主进程**：
  - 主进程入口 `electron/main.js`，预加载脚本 `electron/preload.js`。
  - 数据库访问统一走 `electron/database/*.js` 中的 DAO，与渲染进程之间通过 `window.electronAPI.*` 进行 IPC 通信。
  - 不要在前端直接访问文件系统或数据库。

## 代码风格与技术栈

- **Vue 3**：
  - 统一使用 `Composition API` + `<script setup>` 写法，避免再新增 Options API 组件。
  - 组件内部结构顺序：`import` → 类型定义 → `defineProps/defineEmits` → `ref/computed` → 方法 → 生命周期钩子 → `watch`。
  - 事件命名使用 `kebab-case`（如 `chapter-selected`），处理函数使用 `handleXxx` 命名（如 `handleChapterSelected`）。
- **UI 与样式**：
  - 优先使用 **Element Plus** 组件，不要引入额外 UI 库。
  - 布局优先使用 UnoCSS 原子类（如 `flex items-center justify-between p-4`）。
  - 自定义滚动条样式优先复用目前在 `NovelTree.vue` / `EditorPanel.vue` / `AgentPanel.vue` 中的 `.custom-scrollbar` 写法，保持统一。
  - 新增样式请使用 `scoped`，必要时通过 `:deep()` 覆盖子组件样式。
- **类型与接口**：
  - 类型声明集中在组件顶部或单独 `types` 文件，根据实际需要选择。
  - 优先为 `window.electronAPI` 相关方法在 `src/vite-env.d.ts` 中补充类型声明。

## 交互与功能约定

- **工作台（Workbench）**：
  - 左侧：仅显示小说结构树（章节列表、分页、删除）。
  - 中间：章节编辑器，支持自动保存、状态切换（草稿/写作中/已完成）。
  - 右侧：AI 助手（续写、润色、一致性检查、生成大纲、生成下一章等），所有 AI 操作都通过弹窗让用户可输入自定义提示语。
  - “润色”功能优先作用于编辑器中选中的文字，若无选中内容则作用于整章。
- **设置页**：
  - LLM 配置支持 **多个兼容 OpenAI 协议的模型**，并支持设置默认模型。
  - 设置为全局应用，不与单个小说/章节强绑定。
- **导航约定**：
  - 首页进入的二级页面有返回首页的按钮，三级页面有返回按钮，明显操作。
  - “小说管理”是主要入口，不再引入新的多级菜单体系，保持首页主入口简单。

## Git 与提交信息

- 提交信息遵循类似 Conventional Commits 规范：
  - `feat`: 新功能，如 `feat(workbench): 支持章节分页与删除`
  - `fix`: 修复 bug
  - `ui`: 仅 UI/样式调整
  - `refactor`: 重构（无新功能/修复）
  - `docs`: 文档与开发规范更新
- 为了便于代码审查，单次提交尽量只做一类事情（功能 / 修复 / 样式），不要混在一起。

## 针对 Cursor 的特别提醒

- 在修改现有文件前，先快速浏览文件顶部注释和已有实现，保持风格与命名一致。
- 涉及 **Electron IPC 或数据库结构** 的改动：
  - 优先考虑在 Dao 层和 `preload.js`/`ipcHandlers.js` 中补充功能，而不是在前端直接“临时绕过”。
  - 如需新增表字段或表，务必在 `electron/database/schema.sql` 中补充，并注意向后兼容已有数据。
- 当用户反馈“样式错乱”或“交互不合理”时：
  - 先从 `pages` + `panels` 布局关系入手，检查 Flex 布局和滚动区域。
  - 避免使用 `position: absolute` 做整体布局，优先用 Flex + 尺寸约束（`flex-1`、`flex-shrink-0`、`min-h-0`）。
- 文档类内容（如开发规范）统一维护在项目根目录的 `DEVELOPMENT.md` 中，如有规范更新优先同步该文件。

